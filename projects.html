<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Projects | UNEPP</title>
  <meta name="description" content="UNEPP project portfolio across Egypt, MENA and international markets covering feasibility, FEED, detailed engineering, PMC and procurement." />
  <link rel="stylesheet" href="css/style.css" />
</head>

<body>

  <!-- Header -->
  <header class="nav">
    <div class="container nav-inner">
      <a class="brand" href="index.html">
        <img src="assets/logo.png" alt="UNEPP logo" class="logo" />
        <div>
          <h1>UNEPP</h1>
          <small>United Engineers for Petroleum Projects</small>
        </div>
      </a>

      <nav class="menu" aria-label="Primary">
        <a data-nav href="index.html">Home</a>
        <a data-nav href="about.html">About Us</a>
        <a data-nav href="capabilities.html">Capabilities</a>
        <a data-nav href="projects.html">Projects</a>
        <a data-nav href="news.html">News</a>
        <a data-nav href="careers.html">Career</a>
        <a data-nav class="cta" href="contact.html">Contact Us</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <!-- Page Intro -->
    <section class="section" id="projects-top">
      <div class="section-intro">
        <h2>Project Portfolio</h2>
        <p class="lead">
          Explore selected UNEPP and UNIFIED references across feasibility, FEED, detailed engineering,
          procurement support, and project delivery.
        </p>
      </div>

      <!-- Filters -->
      <div class="card" style="margin-top:14px;">
        <div class="grid" style="grid-template-columns: 1.3fr 1fr 1fr 1fr; align-items:end;">
          <div class="item" style="background: transparent; border: 0; padding: 0;">
            <label class="kicker" for="q" style="display:block; margin-bottom:6px;">Search</label>
            <input id="q" type="search" placeholder="Search projects, clients, country..." style="
              width:100%;
              padding:12px 12px;
              border-radius:12px;
              border:1px solid var(--line);
              background: rgba(255,255,255,.04);
              color: var(--text);
              outline: none;
            "/>
          </div>

          <div class="item" style="background: transparent; border: 0; padding: 0;">
            <label class="kicker" for="client" style="display:block; margin-bottom:6px;">Client</label>
            <select id="client" style="
              width:100%;
              padding:12px 12px;
              border-radius:12px;
              border:1px solid var(--line);
              background: rgba(255,255,255,.04);
              color: var(--text);
              outline: none;
            ">
              <option value="">All</option>
            </select>
          </div>

          <div class="item" style="background: transparent; border: 0; padding: 0;">
            <label class="kicker" for="region" style="display:block; margin-bottom:6px;">Region</label>
            <select id="region" style="
              width:100%;
              padding:12px 12px;
              border-radius:12px;
              border:1px solid var(--line);
              background: rgba(255,255,255,.04);
              color: var(--text);
              outline: none;
            ">
              <option value="">All</option>
            </select>
          </div>

          <div class="item" style="background: transparent; border: 0; padding: 0;">
            <label class="kicker" for="service" style="display:block; margin-bottom:6px;">Service</label>
            <select id="service" style="
              width:100%;
              padding:12px 12px;
              border-radius:12px;
              border:1px solid var(--line);
              background: rgba(255,255,255,.04);
              color: var(--text);
              outline: none;
            ">
              <option value="">All</option>
            </select>
          </div>
        </div>

        <hr class="line" />

        <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap;">
          <div class="kicker" style="letter-spacing:.08em;">
            Showing <span id="count">0</span> projects
          </div>

          <button id="reset" class="btn" type="button">➤ Reset Filters</button>
        </div>
      </div>
    </section>

    <!-- Cards appear here -->
    <section class="section" aria-label="Projects list">
      <div id="projectsGrid" class="grid"></div>

      <!-- Empty state -->
      <div id="emptyState" class="card" style="display:none; margin-top:14px;">
        <h3 style="margin:0 0 8px;">No matches</h3>
        <p class="lead" style="margin:0;">
          Try clearing filters or adjusting the search terms.
        </p>
      </div>

      <!-- Error state -->
      <div id="errorState" class="card" style="display:none; margin-top:14px;">
        <h3 style="margin:0 0 8px;">Couldn’t load projects</h3>
        <p class="lead" style="margin:0;">
          Please confirm <b>data/projects.json</b> exists in your repository and the file name matches exactly (case-sensitive).
        </p>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      © <span id="y"></span> United Engineers for Petroleum Projects (UNEPP)
    </div>
  </footer>

  <script>
    document.getElementById("y").textContent = new Date().getFullYear();

    const els = {
      q: document.getElementById("q"),
      client: document.getElementById("client"),
      region: document.getElementById("region"),
      service: document.getElementById("service"),
      reset: document.getElementById("reset"),
      grid: document.getElementById("projectsGrid"),
      count: document.getElementById("count"),
      empty: document.getElementById("emptyState"),
      error: document.getElementById("errorState"),
    };

    let allProjects = [];

    function uniqSorted(arr) {
      return [...new Set(arr.filter(Boolean))].sort((a,b) => a.localeCompare(b));
    }

    function fillSelect(selectEl, values) {
      const current = selectEl.value;
      selectEl.innerHTML = '<option value="">All</option>' + values.map(v => `<option value="${escapeHtml(v)}">${escapeHtml(v)}</option>`).join("");
      selectEl.value = current; // keep selection when re-filling
    }

    function escapeHtml(str) {
      return String(str ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function matchText(p, q) {
      if (!q) return true;
      const hay = [
        p.Title, p.Client, p.Region, p.Country, p.Service, p.Company, p.Category, p.Tags, p.Summary, p.Year
      ].join(" ").toLowerCase();
      return hay.includes(q.toLowerCase());
    }

    function applyFilters() {
      const q = els.q.value.trim();
      const client = els.client.value;
      const region = els.region.value;
      const service = els.service.value;

      const filtered = allProjects.filter(p => {
        if (client && p.Client !== client) return false;
        if (region && p.Region !== region) return false;
        if (service && p.Service !== service) return false;
        if (!matchText(p, q)) return false;
        return true;
      });

      render(filtered);
    }

    function render(projects) {
      els.count.textContent = String(projects.length);
      els.empty.style.display = projects.length ? "none" : "block";

      els.grid.innerHTML = projects.map(p => {
const showCountry = p.Country && p.Country !== p.Region; // prevents Egypt/Egypt
const badges = [
  p.Client ? `<span class="badge">${escapeHtml(p.Client)}</span>` : "",
  p.Region ? `<span class="badge">${escapeHtml(p.Region)}</span>` : "",
  showCountry ? `<span class="badge">${escapeHtml(p.Country)}</span>` : "",
  p.Service ? `<span class="badge">${escapeHtml(p.Service)}</span>` : "",
  p.Year ? `<span class="badge">${escapeHtml(p.Year)}</span>` : "",
].filter(Boolean).join("");


        return `
          <div class="card">
            <h3 style="margin:0 0 6px;">${escapeHtml(p.Title || "")}</h3>
            ${p.Summary ? `<p class="lead" style="margin:0;">${escapeHtml(p.Summary)}</p>` : `<p class="lead" style="margin:0;">&nbsp;</p>`}
            <div class="badges" style="margin-top:12px;">${badges}</div>
          </div>
        `;
      }).join("");
    }

    async function initProjects() {
      try {
        const res = await fetch("data/projects.json", { cache: "no-store" });
        if (!res.ok) throw new Error("Fetch failed: " + res.status);
        const data = await res.json();

        // normalize expected keys (in case of minor variations)
        allProjects = (Array.isArray(data) ? data : []).map(p => ({
          id: p.id ?? "",
          Title: p.Title ?? p.title ?? "",
          Client: p.Client ?? p.client ?? "",
          Region: p.Region ?? p.region ?? "",
          Country: p.Country ?? p.country ?? "",
          Service: p.Service ?? p.service ?? "",
          Year: p.Year ?? p.year ?? "",
          Company: p.Company ?? p.company ?? "",
          Category: p.Category ?? p.category ?? "",
          Tags: p.Tags ?? p.tags ?? "",
          Summary: p.Summary ?? p.summary ?? "",
        }));

        // Fill filter dropdowns from data
        fillSelect(els.client, uniqSorted(allProjects.map(p => p.Client)));
        fillSelect(els.region, uniqSorted(allProjects.map(p => p.Region)));
        fillSelect(els.service, uniqSorted(allProjects.map(p => p.Service)));

        // Initial render
        render(allProjects);

        // Wire events
        els.q.addEventListener("input", applyFilters);
        els.client.addEventListener("change", applyFilters);
        els.region.addEventListener("change", applyFilters);
        els.service.addEventListener("change", applyFilters);

        els.reset.addEventListener("click", () => {
          els.q.value = "";
          els.client.value = "";
          els.region.value = "";
          els.service.value = "";
          render(allProjects);
        });

      } catch (e) {
        console.error(e);
        els.error.style.display = "block";
      }
    }

    initProjects();
  </script>

</body>
</html>
